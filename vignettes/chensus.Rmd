---
title: "chensus"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{chensus}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


```{r setup, warning=FALSE, message=FALSE}
library(chensus)
library(dplyr)
```

# Introduction

The `chensus` package estimates population frequencies, means,
proportions and confidence intervals from surveys conducted by
the Federal Statistical Office (FSO):

-   structural survey: *Strukturerhebung* (SE) / *relevé structurel* (RS),
-   mobility and transport survey: *Mikrozensus Mobilität und Verkehr*
    (MZMV) / *Microrecensement mobilité et transports* (MRMT).

## Example Data

In this vignette, we demonstrate the main features of the package using the built-in `nhanes` dataset, which contains a subset of data from the [National Health and Nutrition Examination Survey](https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/DEMO_I.htm) for the period 2015-2016 (more with `?nhanes`). Its structure is similar to FSO survey data in that it contains `strata` and `weights` columns and demographic features such as `gender` and `household_size`.

## Notes on Example Data and Interpretation

The `nhanes` dataset included in this package is used solely as a publicly available example to demonstrate how to use `chensus`. In practice, the package is designed for use with FSO's structural survey and mobility and transport survey data. For any other use, results are illustrative only.

The `nhanes` dataset is included with the package. Let us load it and inspect it:
```{r}
data("nhanes")
dplyr::glimpse(nhanes)
nhanes |> count(gender)
nhanes |> count(household_size)
```

# Structural Survery Example Analysis

Suppose we want to estimate the population in the `nhanes` data set by gender and birth country We can use the main analysis function `chensus::se_total()`:

```{r}
se_total(
  data = nhanes,
  weight = weights,
  strata = strata,
  gender, birth_country
)
```

Column names can be passed programmatically with the help of `!!sym()` and `!!!syms()` in the function call:

```{r}
w <- "weights"
s <- "strata"
v <- "gender"

se_total(
  data = nhanes,
  strata = !!sym(s),
  weight = !!sym(w),
  !!sym(v)
)
```
We could also estimate population in parallel for multiple groups:

```{r}
se_total_map(
  nhanes,
  weight = weights,
  strata = strata,
  gender, birth_country
)
```

If on the other hand we would like to estimate the average household size then we would use the function `chensus::se_mean_num()`:

```{r}
se_mean_num(
  data = nhanes,
  variable = household_size,
  strata = strata,
  weight = weights
)
```

We could also estimate the proportion of males and females in the `nhanes` survey, `gender` being a categorical variable, 

```{r}
se_mean_cat(
  data = nhanes,
  variable = gender,
  weight = weights,
  strata = strata
)
```
and by birth country and interview language:

```{r}
se_mean_cat(
  data = nhanes,
  variable = gender,
  weight = weights,
  strata = strata,
  birth_country, interview_lang
)
```

# Mobility Survey

If we would like to estimate the mean household income then we can use the `mzmv_mean()`:
```{r}
mzmv_mean(
  data = nhanes,
  variable = annual_household_income,
  weight = weights
)
```

and grouped by gender (note the variable argument must be quoted here):

```{r}
mzmv_mean_map(
  data = nhanes,
  variable = "annual_household_income",
  gender,
  weight = weights
)
```

