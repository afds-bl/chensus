<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Mathematical Method • chensus</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Mathematical Method">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">chensus</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/chensus.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Method.html">Mathematical Method</a></li>
    <li><a class="dropdown-item" href="../articles/nhanes.html">NHANES Survey Data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/afds-bl/chensus/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Mathematical Method</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/afds-bl/chensus/blob/main/vignettes/Method.Rmd" class="external-link"><code>vignettes/Method.Rmd</code></a></small>
      <div class="d-none name"><code>Method.Rmd</code></div>
    </div>

    
    
<p>This vignette describes the mathematical method for estimating
confidence intervals of the structural survey and mobility and transport
survey conducted by the Swiss Federal Statistical Office (FSO).</p>
<div class="section level2">
<h2 id="structural-survey">Structural survey<a class="anchor" aria-label="anchor" href="#structural-survey"></a>
</h2>
<p>The FSO provides <a href="https://www.bfs.admin.ch/bfs/de/home/statistiken/bevoelkerung/erhebungen/se/methodische-grundlagen-forschung-regionale-partner.assetdetail.11187024.html" class="external-link">formulas
to estimate populations and variances of the structural survey</a> in
German (Section 6).</p>
<p>The estimator depends on:</p>
<ul>
<li>The type of variable:
<ul>
<li>Categorical: a factor-like variable, e.g., gender, country of
birth.</li>
<li>Continuous: a numeric variable, e.g., income, household size.</li>
</ul>
</li>
<li>The type of estimate:
<ul>
<li>Total (sum across the population).</li>
<li>Proportion (relative frequency) or mean (average).</li>
</ul>
</li>
</ul>
<div class="section level3">
<h3 id="population-estimator">Population Estimator<a class="anchor" aria-label="anchor" href="#population-estimator"></a>
</h3>
<p>The estimator of variable <span class="math inline">y</span> depends
on the type of the variable and the desired statistic:</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Variable type</th>
<th>Estimate type</th>
<th>Estimate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Categorical</td>
<td>Total</td>
<td><span class="math inline">\hat{y} = \sum_k w_k I_c(y_k)</span></td>
</tr>
<tr class="even">
<td>Continuous</td>
<td>Total</td>
<td><span class="math inline">\hat{y} = \sum_k w_k y_k</span></td>
</tr>
<tr class="odd">
<td>Categorical</td>
<td>Proportion</td>
<td><span class="math inline">\bar y = \frac{\sum_k w_k I_c(y_k)} {\sum
_k w_k}</span></td>
</tr>
<tr class="even">
<td>Continuous</td>
<td>Mean</td>
<td><span class="math inline">\bar y = \frac {\sum_k w_k y_k} {\sum _k
w_k}</span></td>
</tr>
</tbody>
</table>
<p>where:</p>
<ul>
<li>
<span class="math inline">w_k</span> is the sampling weight for
respondent <span class="math inline">k</span>,</li>
<li>
<span class="math inline">I_c = 1</span> if condition(s) <span class="math inline">c</span> is true, 0 otherwise,</li>
<li>
<span class="math inline">y_k</span> is the observed value for
respondent <span class="math inline">k</span>.</li>
</ul>
<p>The variance of the estimator of the variable <span class="math inline">y</span> is approximated by the variance of the
estimate of variable <span class="math inline">z</span> defined as:</p>
<p><span class="math display">\hat z = \sum_{k \in r} w_k z_k</span></p>
<p>where the transformation <span class="math inline">z_k</span> depends
on both the type of variable <span class="math inline">y</span> and the
desired statistic:</p>
<table class="table">
<colgroup>
<col width="33%">
<col width="33%">
<col width="33%">
</colgroup>
<thead><tr class="header">
<th>Variable type</th>
<th>Estimate type</th>
<th>Transformation <span class="math inline">z_k</span>
</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Categorical</td>
<td>Total</td>
<td><span class="math inline">z_k = I_c(y_k)</span></td>
</tr>
<tr class="even">
<td>Continuous</td>
<td>Total</td>
<td><span class="math inline">z_k = y_k</span></td>
</tr>
<tr class="odd">
<td>Categorical</td>
<td>Proportion</td>
<td><span class="math inline">z_ k = \frac{ y _k - \bar y} {\sum _i
w_i}</span></td>
</tr>
<tr class="even">
<td>Continuous</td>
<td>Mean</td>
<td><span class="math inline">z_k=\frac{y_k - \bar y} {\sum _i
w_i}</span></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="variance-estimator">Variance Estimator<a class="anchor" aria-label="anchor" href="#variance-estimator"></a>
</h3>
<p>The variance estimator for the estimator <span class="math inline">\hat{z}</span> is given by:</p>
<p><span class="math display">\hat V(\hat z) =  \sum_h \frac{m_h}{m_h -
1}\left(1 - \frac{m_h}{N_h}\right) \sum_{i \in r_h}\left(w_i z_i -
\frac{\hat z_h}{m_h}\right)^2</span> where:</p>
<ul>
<li>
<span class="math inline">h</span> is index stratum
(<code>zone</code>),</li>
<li>
<span class="math inline">r_h</span> is the set of respondents in
stratum <span class="math inline">h</span>,</li>
<li>
<span class="math inline">m_h</span> is the number of respondents in
<span class="math inline">r_h</span>,</li>
<li>
<span class="math inline">N_h = \sum_{i \in r_h} w_i</span> is the
estimated population size in stratum <span class="math inline">h</span>,</li>
<li>
<span class="math inline">w_i</span> is the sampling weight for
respondent <span class="math inline">i</span>,</li>
<li>
<span class="math inline">z_i</span> is a transformation of <span class="math inline">y_i</span>.</li>
<li>
<span class="math inline">\hat{z}_h</span> is the estimate of
variable <span class="math inline">z</span> in stratum <span class="math inline">h</span>.</li>
</ul>
<p>The confidence interval is given by:</p>
<p><span class="math display">
\text{CI} = \sqrt{\hat{V}(\hat{z})} \times \text{qnorm}\left(1 -
\frac{\alpha}{2}\right)
</span> where <span class="math inline">\alpha</span> is the
significance level, for example <span class="math inline">\alpha =
0.05</span> for <a href="#confidence-interval">confidence interval</a>
95%.</p>
</div>
<div class="section level3">
<h3 id="simplification-of-variance-estimates">Simplification of Variance Estimates<a class="anchor" aria-label="anchor" href="#simplification-of-variance-estimates"></a>
</h3>
<div class="section level4">
<h4 id="total-of-categorical-variable">Total of Categorical Variable<a class="anchor" aria-label="anchor" href="#total-of-categorical-variable"></a>
</h4>
<p>The estimated total for a condition c is given by:</p>
<p><span class="math display">\hat{N}_c = \sum_{i \in r} w_i I_c</span>
with corresponding variance estimate:</p>
<p><span class="math display">\hat{V}(\hat{N}_c) = \sum_h \frac{m_h}{m_h
- 1} \left(1 - \frac{m_h}{N_h}\right) \sum_{i \in r_h} \left(w_i I_c -
\frac{\hat{N}_{hc}}{m_h}\right)^2</span> where:</p>
<ul>
<li>
<span class="math inline">\hat{N}_c</span> is the total estimate of
condition <span class="math inline">c</span>,</li>
<li>
<span class="math inline">\hat{N}_{hc}</span> is the total estimate
of conditions <span class="math inline">c</span> in stratum <span class="math inline">h</span>,</li>
</ul>
<p>For condition <span class="math inline">c</span>, this term
becomes:</p>
<p><span class="math display">
\begin{aligned}
\sum_{i \in r_h} \left(w_i I_c - \frac{\hat{N}_{hc}}{m_h}\right)^2
&amp;= \sum_{i \notin r_{hc}} \left(\frac{\hat{N}_{hc}}{m_h}\right)^2 +
\sum_{i \in r_{hc}} \left(w_i - \frac{\hat{N}_{hc}}{m_h}\right)^2 \\
&amp;= \left(m_h - m_{hc}\right) \left(\frac{\hat{N}_{hc}}{m_h}\right)^2
+ \sum_{i \in r_{hc}} \left(w_i - \frac{\hat{N}_{hc}}{m_h}\right)^2
\end{aligned}
</span></p>
<p>where <span class="math inline">r_{hc}</span> is the set of
respondents in stratum <span class="math inline">h</span> who fulfill
condition <span class="math inline">c</span>, and <span class="math inline">m_{hc}</span> is the number of respondents in <span class="math inline">r_{hc}</span>.</p>
<p>Thus, the original variance estimate equation becomes:</p>
<p><span class="math display">
\hat{V}(\hat{N}_c) = \sum_h \frac{m_h}{m_h - 1} \left(1 -
\frac{m_h}{N_h}\right) \left[(m_h - m_{hc})
\left(\frac{\hat{N}_{hc}}{m_h}\right)^2 + \sum_{i \in r_{hc}} \left(w_i
- \frac{\hat{N}_{hc}}{m_h}\right)^2\right]
</span></p>
</div>
<div class="section level4">
<h4 id="mean-of-a-continuous-variable">Mean of a Continuous Variable<a class="anchor" aria-label="anchor" href="#mean-of-a-continuous-variable"></a>
</h4>
<p>The estimate of the mean of a continuous variable <span class="math inline">y</span>, for example the average rent
<code>rentnet</code>, is given by the weighted mean:</p>
<p><span class="math display">\bar y = \frac{\sum_k w_k y_k}{\sum_k
w_k}</span></p>
<p>Variance of <span class="math inline">\bar y</span> is approximated
by that of the total of variable <span class="math inline">\hat{z} =
\sum_k w_k z_k</span> where: <span class="math display">z_k = \frac{y_k
- \bar y}{\sum_i w_i}</span></p>
<p>In other words:</p>
<p><span class="math display">\begin{align*}
\hat V(\bar y) &amp; = \hat V(\hat z) \\
&amp; = \sum_h \frac{m_h}{m_h - 1}\left(1 - \frac{m_h}{N_h}\right)
\sum_{i \in r_h}\left(w_i z_i - \frac{\hat z_h}{m_h}\right)^2 \\
&amp; = \sum_h \frac{m_h}{m_h - 1}\left(1 - \frac{m_h}{N_h}\right)
\sum_{i \in r_h}\left(w_i z_i - \frac{\sum_{j \in r_h} w_j
z_j}{m_h}\right)^2 \\
&amp; = \sum_h \frac{m_h}{m_h - 1}\left(1 - \frac{m_h}{N_h}\right)
\sum_{i \in r_h}\left(w_i \frac{y_i - \bar y}{\sum_{j \in r_h} w_j} -
\frac{\sum_{j \in r_h} w_j \left(\frac{y_j - \bar y}{\sum_{k \in r_h}
w_k}\right)}{m_h}\right)^2 \end{align*}</span></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="mobility-and-transport-survey">Mobility and Transport Survey<a class="anchor" aria-label="anchor" href="#mobility-and-transport-survey"></a>
</h2>
<p>From the survey (MZMV/MRMT) data, <code><a href="../reference/mzmv_mean.html">mzmv_mean()</a></code>
estimates:</p>
<ul>
<li>mean or proportion of a variable in the real population: weighted
mean of sub-population of interest,</li>
<li>confidence interval of the estimate with significance level <span class="math inline">\alpha</span>,</li>
</ul>
<p>while <code><a href="../reference/mzmv_mean_map.html">mzmv_mean_map()</a></code> additionally uses grouping
variables.</p>
<p>Note that one can simply use <code><a href="../reference/mzmv_mean.html">mzmv_mean()</a></code> to estimate
both proportions and means, as shown below.</p>
<p>The FSO provides <a href="https://www.bfs.admin.ch/bfs/fr/home/statistiques/mobilite-transports/enquetes/mzmv.assetdetail.4262242.html" class="external-link">formulas
to estimate variances of the MZMV/MRMT</a>.</p>
<div class="section level3">
<h3 id="means">Means<a class="anchor" aria-label="anchor" href="#means"></a>
</h3>
<p>The estimated mean is:</p>
<p><span class="math display">\hat{Y} = \frac{1}{\sum\limits_{i\in r}
w_i}\sum_{i \in r} w_i y_i</span> where:</p>
<ul>
<li>
<span class="math inline">w_i</span> is the weight for participant
<span class="math inline">i</span>,</li>
<li>
<span class="math inline">y_i</span> is the response of participant
<span class="math inline">i</span>,</li>
<li>
<span class="math inline">r</span> is the set of respondents.</li>
</ul>
<p>The <a href="https://www.bfs.admin.ch/bfs/fr/home/statistiques/mobilite-transports/enquetes/mzmv.assetdetail.4262242.html" class="external-link">confidence
interval of the estimated mean</a> is:</p>
<p><span class="math display">
\begin{aligned}\text{CI} &amp;=
1.14\times Z_{\alpha}\frac{\hat{\sigma}_{y}}{\sqrt{n}}\\
&amp;= 1.14 \times \frac{\hat{\sigma}_{y}}{\sqrt{n}} \times
\text{qnorm}(1 - \frac{\alpha}2)
\end{aligned}</span></p>
<p>where:</p>
<ul>
<li>1.14 is a correction factor,</li>
<li>
<span class="math inline">\alpha</span> is the significance level,
for example 0.05 for confidence interval 95%,</li>
<li>
<span class="math inline">Z_{\alpha}</span> is the <a href="https://www.z-table.com/" class="external-link">Z-value</a> for the desired confidence
level (<span class="math inline">Z_{0.05} = 1.96</span> for double-sided
95% confidence interval),</li>
<li>
<span class="math inline">n</span> is the size of set <span class="math inline">r</span>, i.e. number of respondents,</li>
<li>
<span class="math inline">\hat{\sigma}_{y}^2</span> is the variance
of variable <span class="math inline">Y</span> estimated with sample
<span class="math inline">r</span>.</li>
</ul>
<p>The (sample) variance of variable <span class="math inline">Y</span>
is estimated by:</p>
<p><span class="math display">\hat{\sigma}_{y}^2 =
\frac{\sum\limits_{i\in r} w_i \left(y_i -
\bar{y}\right)^2}{\left(\sum\limits_{i \in r} w_i \right)- 1}</span>
where <span class="math inline">\bar{y}</span> is the estimated mean
<span class="math inline">\hat{Y}</span>.</p>
</div>
<div class="section level3">
<h3 id="proportions">Proportions<a class="anchor" aria-label="anchor" href="#proportions"></a>
</h3>
<p>If <span class="math inline">y_i \in \{0, 1\}</span>, for example
possession of a car, then the mean estimate becomes the proportion
estimate:</p>
<p><span class="math display">p = \frac{1}{\sum\limits_{i \in r} w_i}
\sum_{i \in r} w_i I_c</span> where:</p>
<ul>
<li>
<span class="math inline">w_i</span> is the weight for participant
<span class="math inline">i</span>,</li>
<li>
<span class="math inline">I_c = 1</span> if condition <span class="math inline">c</span> is true (<span class="math inline">y_i =
1</span>), 0 otherwise (<span class="math inline">y_i = 0</span>),</li>
<li>
<span class="math inline">r</span> is the set of participants.</li>
</ul>
<p>The sample variance in the previous section then becomes:</p>
<p><span class="math display">\hat{\sigma}_{p}^2 =
\frac{\sum\limits_{i\in r} w_i \left(I_c -
p\right)^2}{\left(\sum\limits_{i \in r} w_i \right)- 1}</span></p>
<p>Noting that <span class="math inline">I_c^2 = I_c</span> and <span class="math inline">\sum\limits_i w_i I_c = p \sum\limits_i w_i</span>,
the nominator then becomes:</p>
<p><span class="math display">
\begin{aligned} \sum\limits_{i\in r} w_i \left(I_c - p\right)^2 &amp;=
\sum_i w_i \left(I_c^2 +p^2 -2pI_c\right) \\
&amp;= \sum_i w_i I_c + p^2 \sum_i w_i -2p\sum_i w_i I_c\\
&amp;= p \sum_i w_i + p^2 \sum_i w_i - 2p^2 \sum_i w_i\\
&amp;= p \sum_i w_i - p^2 \sum_i w_i\\
&amp;= p(1-p) \sum_i w_i
\end{aligned}
</span></p>
<p>Therefore, the estimated sample variance becomes:</p>
<p><span class="math display">\hat{\sigma}_{p}^2 = \frac{p(1-p)
\sum\limits_{i} w_i}{\left(\sum\limits_{i} w_i \right)- 1}</span></p>
<p>which when <span class="math inline">\sum\limits_i w_i &gt;&gt;
1</span> can be approximated with:</p>
<p><span class="math display">\hat{\sigma}_{p}^2 \approx
p(1-p)</span></p>
<p>The confidence interval for proportions could therefore be
approximated with:</p>
<p><span class="math display">\text{CI} \approx 1.14 \times
\sqrt{\frac{p(1-p)}{n}} \times \text{qnorm}(1 - \frac{\alpha} 2)</span>
where:</p>
<ul>
<li>
<span class="math inline">\alpha</span> is the significance
level,</li>
<li>
<span class="math inline">\text{qnorm}</span> outputs the Z-score
for the required significance level <span class="math inline">\alpha</span>,</li>
<li>
<span class="math inline">n</span> is the size of set <span class="math inline">r</span>, i.e. number of respondents.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="confidence-interval">Confidence Interval - Definition<a class="anchor" aria-label="anchor" href="#confidence-interval"></a>
</h2>
<p>A confidence interval is a range of plausible values for a population
parameter, calculated from sample data. A 95% confidence interval means
that if the same sampling procedure were repeated many times,
approximately 95% of the resulting intervals would contain the true
population value. This does not imply that there is a 95% probability
that the true value lies within any single interval, rather, it reflects
the reliability of the estimation method across repeated samples.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Souad Guemghar, Amt für Daten und Statistik, Basel-Landschaft.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
